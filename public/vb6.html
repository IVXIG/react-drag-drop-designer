
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Basic 6.0 Web IDE</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
  <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
  <style>
    /* Global Styles */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      background-color: #D4D0C8;
    }
    
    /* Reset */
    * {
      box-sizing: border-box;
    }
    
    /* Windows 98/VB6 Style UI Components */
    .win98-btn {
      background-color: #D4D0C8;
      border: 2px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      padding: 2px 6px;
      font-size: 11px;
      font-family: 'Tahoma', sans-serif;
      cursor: pointer;
      color: black;
      margin: 1px;
      height: 22px;
      min-width: 75px;
      text-align: center;
      box-shadow: none;
      border-radius: 0;
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    .win98-btn:active {
      border-color: #808080 #FFFFFF #FFFFFF #808080;
      background-color: #D4D0C8;
    }
    
    .win98-btn:hover {
      background-color: #D4D0C8;
    }
    
    .win98-btn.menu-btn {
      background-color: #D4D0C8;
      color: black;
      border: 1px solid transparent;
      font-family: 'Tahoma', sans-serif;
      font-weight: normal;
      margin-right: 0;
      min-width: auto;
      height: 18px;
      padding: 1px 6px;
    }
    
    .win98-btn.menu-btn:hover {
      border: 1px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
    }
    
    .win98-window {
      background-color: #D4D0C8;
      border: 2px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      position: absolute;
      overflow: hidden;
    }
    
    .win98-title-bar {
      background-color: #000080;
      color: white;
      padding: 2px 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: move;
      height: 18px;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
    }
    
    .win98-title {
      font-weight: bold;
      font-size: 11px;
    }
    
    .win98-controls {
      display: flex;
      gap: 2px;
    }
    
    .win98-control {
      background-color: #D4D0C8;
      border: 1px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      color: black;
      width: 14px;
      height: 14px;
      font-size: 9px;
      line-height: 12px;
      text-align: center;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .win98-control:active {
      border-color: #808080 #FFFFFF #FFFFFF #808080;
    }
    
    /* Toolbar Styling */
    .toolbar {
      background-color: #D4D0C8;
      border: 2px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      height: 28px;
      display: flex;
      align-items: center;
      padding: 0 4px;
    }
    
    .toolbar-btn {
      background-color: #D4D0C8;
      border: 1px solid transparent;
      height: 22px;
      width: 24px;
      margin: 0 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .toolbar-btn:hover {
      border: 1px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
    }
    
    .toolbar-btn:active {
      border-color: #808080 #FFFFFF #FFFFFF #808080;
    }
    
    .toolbar-divider {
      width: 1px;
      height: 70%;
      background-color: #808080;
      margin: 0 6px;
    }
    
    /* Toolbox Styling */
    .toolbox {
      width: 200px;
      height: calc(100vh - 76px);
      background-color: #D4D0C8;
      border: 2px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      position: absolute;
      left: 0;
      top: 76px;
    }
    
    .toolbox-title {
      background-color: #000080;
      color: white;
      text-align: left;
      padding: 2px 4px;
      font-weight: bold;
      font-size: 11px;
      cursor: pointer;
    }
    
    .toolbox-category {
      margin-bottom: 4px;
    }
    
    .toolbox-category-header {
      background-color: #D4D0C8;
      color: black;
      font-weight: bold;
      padding: 2px 4px;
      border: 1px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      cursor: pointer;
      font-size: 11px;
    }
    
    .toolbox-item {
      background-color: #D4D0C8;
      border: 1px solid transparent;
      margin: 2px 4px;
      padding: 2px 4px;
      cursor: move;
      font-size: 11px;
      display: flex;
      align-items: center;
    }
    
    .toolbox-item:hover {
      border: 1px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
    }
    
    .toolbox-item-icon {
      width: 16px;
      height: 16px;
      margin-right: 4px;
      background-color: #D4D0C8;
      border: 1px solid;
      border-color: #808080 #FFFFFF #FFFFFF #808080;
    }
    
    /* Designer Canvas */
    .designer-canvas {
      background-color: white;
      width: 100%;
      height: 100%;
      position: relative;
      overflow: auto;
    }
    
    .grid-cell {
      border: 1px dotted #D0D0D0;
      position: absolute;
    }
    
    /* Controls on canvas */
    .control {
      position: absolute;
      background-color: #D4D0C8;
      border: 1px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
    }
    
    .control.selected {
      border: 1px dashed black;
    }
    
    .resize-handle {
      width: 6px;
      height: 6px;
      background-color: black;
      position: absolute;
      bottom: 0;
      right: 0;
      cursor: se-resize;
    }
    
    /* Properties Window */
    .properties-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1px;
      overflow-y: auto;
      background-color: white;
      height: calc(100% - 28px);
      border: 1px solid;
      border-color: #808080 #FFFFFF #FFFFFF #808080;
    }
    
    .property-name {
      background-color: #D4D0C8;
      padding: 1px 4px;
      font-weight: normal;
      font-size: 11px;
      border-bottom: 1px solid #808080;
    }
    
    .property-value {
      background-color: white;
      padding: 1px;
      border-bottom: 1px solid #808080;
    }
    
    .property-value input,
    .property-value select {
      width: 100%;
      height: 100%;
      padding: 0 2px;
      margin: 0;
      border: none;
      font-size: 11px;
      font-family: 'Tahoma', sans-serif;
    }
    
    /* Project Explorer */
    .project-explorer-item {
      margin: 1px 0;
      cursor: pointer;
      font-size: 11px;
      padding: 1px 4px;
    }
    
    .project-explorer-item:hover {
      background-color: #0A246A;
      color: white;
    }
    
    .project-folder {
      font-weight: normal;
    }
    
    .project-file {
      margin-left: 16px;
    }
    
    /* Menu Dropdown */
    .menu-dropdown {
      position: absolute;
      background-color: #D4D0C8;
      border: 2px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      display: none;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
      padding: 2px;
      min-width: 150px;
    }
    
    .menu-dropdown.show {
      display: block;
    }
    
    .menu-item {
      padding: 1px 10px;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .menu-item:hover {
      background-color: #0A246A;
      color: white;
    }
    
    .menu-separator {
      height: 1px;
      background-color: #808080;
      margin: 2px 2px;
    }
    
    /* Dialog Styles */
    .dialog-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .dialog {
      background-color: #D4D0C8;
      border: 2px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
      min-width: 300px;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
    }
    
    .dialog-title {
      background-color: #000080;
      color: white;
      font-weight: bold;
      padding: 2px 4px;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
    }
    
    .dialog-content {
      padding: 10px;
    }
    
    .dialog-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      padding: 6px 10px;
      border-top: 1px solid #808080;
    }
    
    /* Status Bar */
    .status-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 18px;
      background-color: #D4D0C8;
      border-top: 1px solid #808080;
      display: flex;
      padding: 0;
      font-size: 11px;
      font-family: 'Tahoma', sans-serif;
    }
    
    .status-item {
      padding: 0 8px;
      border-right: 1px solid #808080;
      display: flex;
      align-items: center;
      height: 100%;
    }
    
    /* Toasts */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 10000;
    }
    
    .toast {
      background-color: #FFFFCC;
      border: 1px solid #808080;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      margin-top: 8px;
      padding: 6px 10px;
      max-width: 300px;
      animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
      animation-fill-mode: forwards;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
    
    /* Code Editor */
    .code-editor {
      width: 100%;
      height: calc(100% - 18px);
      background-color: white;
      padding: 0;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    
    .code-textarea {
      width: 100%;
      height: 100%;
      background-color: white;
      border: none;
      padding: 4px;
      resize: none;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      tab-size: 4;
      white-space: pre;
      overflow: auto;
    }
    
    /* VB6 specific styles */
    .vb6-form {
      position: relative;
      background-color: #D4D0C8;
      margin: 20px;
      width: 400px;
      height: 300px;
      border: 1px solid #000000;
    }
    
    .form-title {
      background-color: #000080;
      color: white;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
      font-weight: bold;
      padding: 2px 4px;
      cursor: move;
    }
    
    /* Tab controls for property pages and code window */
    .tab-control {
      display: flex;
      background-color: #D4D0C8;
      height: 20px;
      align-items: center;
      border-bottom: 1px solid #808080;
    }
    
    .tab-item {
      padding: 2px 8px;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
      cursor: pointer;
      border: 1px solid;
      border-color: #FFFFFF #808080 transparent #FFFFFF;
      margin-right: 1px;
    }
    
    .tab-item.active {
      background-color: #FFFFFF;
      border-bottom: 1px solid #FFFFFF;
      z-index: 1;
    }
    
    /* Form control styles */
    .form-control {
      position: absolute;
      background-color: #D4D0C8;
    }
    
    .command-button {
      border: 1px solid;
      border-color: #FFFFFF #808080 #808080 #FFFFFF;
      text-align: center;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
      padding: 2px;
    }
    
    .text-box {
      border: 1px solid;
      border-color: #808080 #FFFFFF #FFFFFF #808080;
      background-color: white;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
      padding: 2px;
    }
    
    .label {
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
      overflow: hidden;
    }
    
    .checkbox {
      display: flex;
      align-items: center;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
    }
    
    .option-button {
      display: flex;
      align-items: center;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
    }
    
    .combobox {
      border: 1px solid;
      border-color: #808080 #FFFFFF #FFFFFF #808080;
      background-color: white;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
    }
    
    .list-box {
      border: 1px solid;
      border-color: #808080 #FFFFFF #FFFFFF #808080;
      background-color: white;
      font-family: 'Tahoma', sans-serif;
      font-size: 11px;
    }
    
    .frame {
      border: 2px groove #D4D0C8;
    }
  </style>
</head>
<body>
  <!-- Menu Bar -->
  <div id="menu-bar" style="background-color: #D4D0C8; height: 20px; display: flex; align-items: center; border-bottom: 1px solid #808080;">
    <button id="file-menu-btn" class="win98-btn menu-btn" data-menu="file-menu">File</button>
    <button id="edit-menu-btn" class="win98-btn menu-btn" data-menu="edit-menu">Edit</button>
    <button id="view-menu-btn" class="win98-btn menu-btn" data-menu="view-menu">View</button>
    <button id="project-menu-btn" class="win98-btn menu-btn" data-menu="project-menu">Project</button>
    <button id="format-menu-btn" class="win98-btn menu-btn" data-menu="format-menu">Format</button>
    <button id="debug-menu-btn" class="win98-btn menu-btn" data-menu="debug-menu">Debug</button>
    <button id="run-menu-btn" class="win98-btn menu-btn" data-menu="run-menu">Run</button>
    <button id="tools-menu-btn" class="win98-btn menu-btn" data-menu="tools-menu">Tools</button>
    <button id="addins-menu-btn" class="win98-btn menu-btn" data-menu="addins-menu">Add-Ins</button>
    <button id="window-menu-btn" class="win98-btn menu-btn" data-menu="window-menu">Window</button>
    <button id="help-menu-btn" class="win98-btn menu-btn" data-menu="help-menu">Help</button>
  </div>
  
  <!-- Toolbar -->
  <div id="toolbar" class="toolbar">
    <div class="toolbar-btn" id="new-btn" title="New Project">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIgjI+py+0Po5wg2ovrxLrr7nUhGJXmKZ5oqq4s632VbAEAOw==" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="open-btn" title="Open Project">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIfjI+py+0PIwMg2ovuBYxrzXUdKI6deJppyk6tC8NxAQA7" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="save-btn" title="Save Project">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIfhI+py+0PY5i0Voqz3rz7D4biSJbmiabqKkTuTaUFADs=" width="16" height="16">
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-btn" id="cut-btn" title="Cut">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIejI+py+0PYwC02osyDJfa3nUex5VfGZJnaq6uyrYFADs=" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="copy-btn" title="Copy">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIejI+py+0PIwNh2mssrmz7r20eqI3BiZ5opa7qy34FADs=" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="paste-btn" title="Paste">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIfjI+py+0PoQBhgmdorjvrznkdJ3Zi9JWUVk6p6s5CAQAh" width="16" height="16">
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-btn" id="find-btn" title="Find">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIhjI+py+0PEwCx2osJ2f3bDoYeCI5gCV5oyl4s1K2Jy9NRAQA7" width="16" height="16">
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-btn" id="run-btn" title="Start">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIajI+py+0Po5wg2ovzsa3r73VYVYmkWZps+kYFADs=" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="break-btn" title="Break">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIgjI+py+0PH5h0Jrwt3kPhzXAVJnIkd5mlF6k42y5XAQA7" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="end-btn" title="End">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIejI+py+0PI5i0oguy3rz7D4biRz5fmabqyrbuC0cFADs=" width="16" height="16">
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-btn" id="project-explorer-btn" title="Project Explorer">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIgjI+py+0Po5wJ2ouz3rz7D4biSJbmiabqyrbuC8fyTNcFADs=" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="properties-btn" title="Properties Window">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIhjI+py+0PF4i02ouz3rz7D4biSJbmiabqyrbuC8fyTNcFADs=" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="form-view-btn" title="View Form">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIejI+py+0PIwCx2ouz3rz7D3YiMo3miWKp2q5L+7ZXAQA7" width="16" height="16">
    </div>
    <div class="toolbar-btn" id="code-view-btn" title="View Code">
      <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAP///yH5BAEAAAEALAAAAAAQABAAAAIfjI+py+0PF5i02ouz3rz7D4biSJbmiVqo2kbuC7vyTNcFADs=" width="16" height="16">
    </div>
  </div>
  
  <!-- Menu Dropdowns -->
  <div id="file-menu" class="menu-dropdown">
    <div class="menu-item" id="file-new">New Project...</div>
    <div class="menu-item" id="file-open">Open Project...</div>
    <div class="menu-item" id="file-save">Save Project</div>
    <div class="menu-item" id="file-save-as">Save Project As...</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="file-print">Print...</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="file-make">Make Project1.exe...</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="file-exit">Exit</div>
  </div>
  
  <div id="edit-menu" class="menu-dropdown">
    <div class="menu-item" id="edit-undo">Undo</div>
    <div class="menu-item" id="edit-redo">Redo</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="edit-cut">Cut</div>
    <div class="menu-item" id="edit-copy">Copy</div>
    <div class="menu-item" id="edit-paste">Paste</div>
    <div class="menu-item" id="edit-delete">Delete</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="edit-select-all">Select All</div>
  </div>
  
  <div id="view-menu" class="menu-dropdown">
    <div class="menu-item" id="view-code">Code</div>
    <div class="menu-item" id="view-object">Object</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="view-definition">Definition</div>
    <div class="menu-item" id="view-last-position">Last Position</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="view-object-browser">Object Browser...</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="view-toolbox">Toolbox</div>
    <div class="menu-item" id="view-project-explorer">Project Explorer</div>
    <div class="menu-item" id="view-properties-window">Properties Window</div>
    <div class="menu-item" id="view-form-layout">Form Layout Window</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="view-toolbar">Toolbar</div>
    <div class="menu-item" id="view-color-palette">Color Palette</div>
  </div>
  
  <div id="project-menu" class="menu-dropdown">
    <div class="menu-item" id="project-add-form">Add Form</div>
    <div class="menu-item" id="project-add-module">Add Module</div>
    <div class="menu-item" id="project-add-class">Add Class Module</div>
    <div class="menu-item" id="project-add-usercontrol">Add UserControl</div>
    <div class="menu-item" id="project-add-property-page">Add Property Page</div>
    <div class="menu-item" id="project-add-user-document">Add User Document</div>
    <div class="menu-item" id="project-add-user-control">Add User Control</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="project-references">References...</div>
    <div class="menu-item" id="project-components">Components...</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="project-properties">Project1 Properties...</div>
  </div>
  
  <div id="format-menu" class="menu-dropdown">
    <div class="menu-item" id="format-align">Align</div>
    <div class="menu-item" id="format-make-same-size">Make Same Size</div>
    <div class="menu-item" id="format-size-to-grid">Size to Grid</div>
    <div class="menu-item" id="format-horizontal-spacing">Horizontal Spacing</div>
    <div class="menu-item" id="format-vertical-spacing">Vertical Spacing</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="format-center-in-form">Center in Form</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="format-lock-controls">Lock Controls</div>
  </div>
  
  <div id="debug-menu" class="menu-dropdown">
    <div class="menu-item" id="debug-start">Start</div>
    <div class="menu-item" id="debug-start-with-full-compile">Start with Full Compile</div>
    <div class="menu-item" id="debug-break">Break</div>
    <div class="menu-item" id="debug-end">End</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="debug-step-into">Step Into</div>
    <div class="menu-item" id="debug-step-over">Step Over</div>
    <div class="menu-item" id="debug-step-out">Step Out</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="debug-toggle-breakpoint">Toggle Breakpoint</div>
    <div class="menu-item" id="debug-clear-all-breakpoints">Clear All Breakpoints</div>
  </div>
  
  <div id="run-menu" class="menu-dropdown">
    <div class="menu-item" id="run-start">Start</div>
    <div class="menu-item" id="run-start-with-full-compile">Start with Full Compile</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="run-break">Break</div>
    <div class="menu-item" id="run-end">End</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="run-restart">Restart</div>
  </div>
  
  <div id="tools-menu" class="menu-dropdown">
    <div class="menu-item" id="tools-menu-editor">Menu Editor...</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="tools-options">Options...</div>
  </div>
  
  <div id="help-menu" class="menu-dropdown">
    <div class="menu-item" id="help-contents">Microsoft Visual Basic Help</div>
    <div class="menu-separator"></div>
    <div class="menu-item" id="help-about">About Microsoft Visual Basic...</div>
  </div>
  
  <!-- Toolbox Window -->
  <div id="toolbox" class="win98-window toolbox" style="width: 28px;">
    <div class="win98-title-bar" id="toolbox-title-bar">
      <div class="win98-title">Toolbox</div>
      <div class="win98-controls">
        <div class="win98-control" id="toolbox-minimize">_</div>
        <div class="win98-control" id="toolbox-close">x</div>
      </div>
    </div>
    <div id="toolbox-container" style="padding: 1px; overflow-y: auto; height: calc(100% - 18px);">
      <div class="toolbar-btn" id="pointer-tool" title="Pointer" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAIUjI8JkL3b2IuSmoqR0bzvJShVj1UAOW=" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="label-tool" title="Label" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAIVjI+JoMvdgItxojlzu9n1jX3iGJYFADs=" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="textbox-tool" title="TextBox" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAIVjI+py+0fYgRy0Soi1vzj7XngGJYFADs=" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="command-button-tool" title="CommandButton" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAITjI+py+0PYwRUsmoNvbv3D4biWAAAOw==" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="checkbox-tool" title="CheckBox" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAIUjI+py+0PHZgQsopxvYvzD4ZiWAAAOw==" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="option-button-tool" title="OptionButton" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAITjI+py+0PnZtAsopxvXzz7XlgWQAAOw==" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="list-box-tool" title="ListBox" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAITjI+py+0Po5y02ouz3rz7DyriWAAAOw==" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="combo-box-tool" title="ComboBox" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAITjI+py+0Po5y02ouzhrn7DoriWAAAOw==" width="16" height="16">
      </div>
      <div class="toolbar-btn" id="frame-tool" title="Frame" style="margin: 1px; width: 24px; height: 24px;">
        <img src="data:image/gif;base64,R0lGODlhDAAMAIAAAAAAAP///yH5BAEAAAEALAAAAAAMAAwAAAITjI+py+0PYwi02mqxDrj2D4ZiWAAAOw==" width="16" height="16">
      </div>
    </div>
  </div>
  
  <!-- Main Form Designer Window -->
  <div id="form-designer" class="win98-window" style="left: 40px; top: 76px; width: 600px; height: calc(100vh - 120px); z-index: 10;">
    <div class="win98-title-bar" id="form-designer-title-bar">
      <div class="win98-title">Form1 (Form)</div>
      <div class="win98-controls">
        <div class="win98-control" id="form-designer-minimize">_</div>
        <div class="win98-control" id="form-designer-maximize">□</div>
        <div class="win98-control" id="form-designer-close">x</div>
      </div>
    </div>
    <div id="designer-canvas" class="designer-canvas"></div>
  </div>
  
  <!-- Project Explorer Window -->
  <div id="project-explorer" class="win98-window" style="right: 20px; top: 76px; width: 250px; height: 300px; z-index: 20;">
    <div class="win98-title-bar" id="project-explorer-title-bar">
      <div class="win98-title">Project - Project1</div>
      <div class="win98-controls">
        <div class="win98-control" id="project-explorer-minimize">_</div>
        <div class="win98-control" id="project-explorer-close">x</div>
      </div>
    </div>
    <div style="padding: 2px; height: calc(100% - 18px); overflow-y: auto;">
      <div class="project-explorer-item project-folder" data-folder="project1">
        <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAP///wAAACH5BAEAAAEALAAAAAAQABAAAAIjjI+py+0Po5wSmVqB1cT2jXlf+HkiNpZlRZZqd7Vt87bTTRQAOw==" width="16" height="16" style="vertical-align: middle;">
        <span>Project1 (Project1)</span>
        <div style="margin-left: 16px;">
          <div class="project-explorer-item project-file" data-file="form1.frm">
            <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAP///wAAACH5BAEAAAEALAAAAAAQABAAAAIfjI+py+0Po5wg2ntn1SnzD3bipHWkh5XmiabqyrbuiwAAOw==" width="16" height="16" style="vertical-align: middle;">
            <span>Form1 (Form1.frm)</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Properties Window -->
  <div id="properties-window" class="win98-window" style="right: 20px; bottom: 20px; width: 250px; height: calc(100vh - 416px); z-index: 20;">
    <div class="win98-title-bar" id="properties-title-bar">
      <div class="win98-title">Properties - Form1</div>
      <div class="win98-controls">
        <div class="win98-control" id="properties-minimize">_</div>
        <div class="win98-control" id="properties-close">x</div>
      </div>
    </div>
    <div style="height: calc(100% - 18px);">
      <div class="tab-control">
        <div class="tab-item active" id="properties-tab-alphabetic">Alphabetic</div>
        <div class="tab-item" id="properties-tab-categorized">Categorized</div>
      </div>
      <div id="no-selection" style="padding: 8px; color: #808080; font-style: italic; display: none;">
        No control selected. Select a control to view its properties.
      </div>
      <div id="properties-grid" class="properties-grid">
        <!-- Properties will be added here dynamically -->
        <div class="property-name">BackColor</div>
        <div class="property-value"><input type="text" value="&H8000000F&"></div>
        <div class="property-name">Caption</div>
        <div class="property-value"><input type="text" value="Form1"></div>
        <div class="property-name">ClientHeight</div>
        <div class="property-value"><input type="text" value="3600"></div>
        <div class="property-name">ClientLeft</div>
        <div class="property-value"><input type="text" value="60"></div>
        <div class="property-name">ClientTop</div>
        <div class="property-value"><input type="text" value="345"></div>
        <div class="property-name">ClientWidth</div>
        <div class="property-value"><input type="text" value="4680"></div>
        <div class="property-name">Height</div>
        <div class="property-value"><input type="text" value="4005"></div>
        <div class="property-name">Left</div>
        <div class="property-value"><input type="text" value="0"></div>
        <div class="property-name">Name</div>
        <div class="property-value"><input type="text" value="Form1"></div>
        <div class="property-name">ScaleHeight</div>
        <div class="property-value"><input type="text" value="3600"></div>
        <div class="property-name">ScaleWidth</div>
        <div class="property-value"><input type="text" value="4680"></div>
        <div class="property-name">Top</div>
        <div class="property-value"><input type="text" value="0"></div>
        <div class="property-name">Width</div>
        <div class="property-value"><input type="text" value="4800"></div>
      </div>
    </div>
  </div>
  
  <!-- Code Editor Window (Initially Hidden) -->
  <div id="code-window" class="win98-window" style="left: 40px; top: 76px; width: 600px; height: calc(100vh - 120px); display: none; z-index: 30;">
    <div class="win98-title-bar" id="code-window-title-bar">
      <div class="win98-title">Form1 (Code)</div>
      <div class="win98-controls">
        <div class="win98-control" id="code-window-minimize">_</div>
        <div class="win98-control" id="code-window-maximize">□</div>
        <div class="win98-control" id="code-window-close">x</div>
      </div>
    </div>
    <div class="tab-control">
      <div class="tab-item active">General</div>
      <div class="tab-item">Declarations</div>
    </div>
    <div class="code-editor">
      <textarea id="code-textarea" class="code-textarea" spellcheck="false">' Code for Form1

Option Explicit

Private Sub Form_Load()
  ' Initialize form
  Me.Caption = "Form1"
End Sub

Private Sub Form_Click()
  ' Add your code here
  MsgBox "Form clicked!"
End Sub
</textarea>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div id="status-mode" class="status-item">Design</div>
    <div id="status-position" class="status-item">Ln 1, Col 1</div>
    <div id="status-selection" class="status-item">Form1</div>
    <div id="status-saved" class="status-item">Saved</div>
  </div>
  
  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>
  
  <!-- Dialogs (Initially Hidden) -->
  <div id="about-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-title">
        <span>About Microsoft Visual Basic</span>
        <span class="win98-control" id="about-dialog-close">x</span>
      </div>
      <div class="dialog-content" style="text-align: center;">
        <h2 style="font-size: 14px; margin: 8px 0;">Microsoft Visual Basic 6.0</h2>
        <p style="margin: 8px 0;">Professional Edition</p>
        <p style="margin: 8px 0;">Copyright © 1987-1998 Microsoft Corp.</p>
        <p style="margin: 8px 0;">This is a web-based recreation of the Visual Basic 6.0 IDE.</p>
      </div>
      <div class="dialog-buttons">
        <button class="win98-btn" id="about-dialog-ok">OK</button>
      </div>
    </div>
  </div>
  
  <div id="new-project-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-title">
        <span>New Project</span>
        <span class="win98-control" id="new-project-dialog-close">x</span>
      </div>
      <div class="dialog-content">
        <div style="margin-bottom: 8px;">
          <div style="font-weight: bold; margin-bottom: 4px;">New</div>
          <div style="display: flex; height: 200px; border: 1px solid #808080;">
            <div style="width: 120px; height: 100%; overflow-y: auto; border-right: 1px solid #808080;">
              <div style="padding: 2px 4px; background-color: #0A246A; color: white;">Standard EXE</div>
              <div style="padding: 2px 4px;">ActiveX EXE</div>
              <div style="padding: 2px 4px;">ActiveX DLL</div>
              <div style="padding: 2px 4px;">ActiveX Control</div>
              <div style="padding: 2px 4px;">VB Application Wizard</div>
              <div style="padding: 2px 4px;">Data Project</div>
              <div style="padding: 2px 4px;">IIS Application</div>
              <div style="padding: 2px 4px;">Add-in</div>
            </div>
            <div style="flex-grow: 1; padding: 8px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
              <img src="data:image/gif;base64,R0lGODlhIAAgAIAAAAAAAP///yH5BAEAAAEALAAAAAAgACAAAAJDjI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMpvMJjUqn1Kr1is1qt9yuVwIAOw==" width="32" height="32">
              <div style="text-align: center; margin-top: 8px;">Standard EXE</div>
              <div style="text-align: center; margin-top: 4px;">Creates a standard Visual Basic application (.exe)</div>
            </div>
          </div>
        </div>
      </div>
      <div class="dialog-buttons">
        <button class="win98-btn" id="new-project-dialog-ok">Open</button>
        <button class="win98-btn" id="new-project-dialog-cancel">Cancel</button>
      </div>
    </div>
  </div>
  
  <div id="open-project-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-title">
        <span>Open Project</span>
        <span class="win98-control" id="open-project-dialog-close">x</span>
      </div>
      <div class="dialog-content">
        <div style="margin-bottom: 8px;">
          <div style="font-weight: bold; margin-bottom: 4px;">Look in:</div>
          <div style="display: flex; align-items: center; border: 1px solid; border-color: #808080 #FFFFFF #FFFFFF #808080; padding: 2px;">
            <select style="flex-grow: 1; border: none;">
              <option>C:\VB Projects</option>
            </select>
          </div>
        </div>
        <div style="height: 200px; border: 1px solid; border-color: #808080 #FFFFFF #FFFFFF #808080; overflow-y: auto; background-color: white;">
          <div style="padding: 2px 4px; display: flex; align-items: center;">
            <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAP///wAAACH5BAEAAAEALAAAAAAQABAAAAIjjI+py+0Po5wB2Iuzy4HzD3lfeIBUZJrZya1qy74ZTM+1UR8FADs=" width="16" height="16" style="margin-right: 4px;">
            <span>Project1.vbp</span>
          </div>
          <div style="padding: 2px 4px; display: flex; align-items: center;">
            <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAP///wAAACH5BAEAAAEALAAAAAAQABAAAAIjjI+py+0Po5wB2Iuzy4HzD3lfeIBUZJrZya1qy74ZTM+1UR8FADs=" width="16" height="16" style="margin-right: 4px;">
            <span>Calculator.vbp</span>
          </div>
          <div style="padding: 2px 4px; display: flex; align-items: center;">
            <img src="data:image/gif;base64,R0lGODlhEAAQAIAAAP///wAAACH5BAEAAAEALAAAAAAQABAAAAIjjI+py+0Po5wB2Iuzy4HzD3lfeIBUZJrZya1qy74ZTM+1UR8FADs=" width="16" height="16" style="margin-right: 4px;">
            <span>TextEditor.vbp</span>
          </div>
        </div>
        <div style="margin-top: 8px;">
          <div style="font-weight: bold; margin-bottom: 4px;">File name:</div>
          <div style="display: flex; align-items: center;">
            <input type="text" style="flex-grow: 1; border: 1px solid; border-color: #808080 #FFFFFF #FFFFFF #808080; padding: 2px;" value="Project1.vbp">
          </div>
        </div>
      </div>
      <div class="dialog-buttons">
        <button class="win98-btn" id="open-project-dialog-open">Open</button>
        <button class="win98-btn" id="open-project-dialog-cancel">Cancel</button>
      </div>
    </div>
  </div>
  
  <div id="delete-control-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-title">
        <span>Microsoft Visual Basic</span>
        <span class="win98-control" id="delete-control-dialog-close">x</span>
      </div>
      <div class="dialog-content">
        <p>Are you sure you want to delete this control?</p>
      </div>
      <div class="dialog-buttons">
        <button class="win98-btn" id="delete-control-dialog-yes">Yes</button>
        <button class="win98-btn" id="delete-control-dialog-no">No</button>
      </div>
    </div>
  </div>
  
  <script>
    // Application State
    const state = {
      controls: [],
      selectedControlId: null,
      isInDesignMode: true,
      isRunning: false,
      projectIsDirty: false,
      visibleWindows: {
        mainWindow: true,
        propertyWindow: true,
        projectWindow: true,
        codeWindow: false,
        toolbox: true
      },
      minimizedWindows: {
        mainWindow: false,
        propertyWindow: false,
        projectWindow: false,
        codeWindow: false,
        toolbox: false
      },
      expandedCategories: {
        'Common Controls': true,
        'Additional Controls': false
      },
      currentCodeControlId: null,
      controlCode: {}, // Store code for each control
      snapToGrid: true,
      gridSize: 120 // Grid size in twips (120 twips = 8 pixels in 96 DPI)
    };
    
    // Toast Notification System
    const toast = {
      container: document.getElementById('toast-container'),
      
      show: function(message, type = 'info') {
        const toastElement = document.createElement('div');
        toastElement.className = 'toast';
        toastElement.textContent = message;
        
        if (type === 'error') {
          toastElement.style.backgroundColor = '#FFCCCC';
          toastElement.style.borderColor = '#FF0000';
        }
        
        this.container.appendChild(toastElement);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
          toastElement.addEventListener('animationend', () => {
            if (toastElement.parentNode === this.container) {
              this.container.removeChild(toastElement);
            }
          });
        }, 3000);
      }
    };
    
    // Window Management System
    const windows = {
      makeWindowDraggable: function(windowEl, titleBarEl) {
        let isDragging = false;
        let offsetX = 0;
        let offsetY = 0;
        
        titleBarEl.addEventListener('mousedown', (e) => {
          if (e.target !== titleBarEl && !e.target.classList.contains('win98-title')) return;
          
          isDragging = true;
          const rect = windowEl.getBoundingClientRect();
          offsetX = e.clientX - rect.left;
          offsetY = e.clientY - rect.top;
          
          windowEl.style.zIndex = this.getHighestZIndex() + 1;
        });
        
        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          
          const newLeft = e.clientX - offsetX;
          const newTop = e.clientY - offsetY;
          
          windowEl.style.left = `${newLeft}px`;
          windowEl.style.top = `${newTop}px`;
        });
        
        document.addEventListener('mouseup', () => {
          isDragging = false;
        });
      },
      
      getHighestZIndex: function() {
        return Math.max(
          parseInt(document.getElementById('form-designer').style.zIndex || 10),
          parseInt(document.getElementById('properties-window').style.zIndex || 20),
          parseInt(document.getElementById('project-explorer').style.zIndex || 20),
          parseInt(document.getElementById('code-window').style.zIndex || 30),
          parseInt(document.getElementById('toolbox').style.zIndex || 20)
        );
      },
      
      toggleMinimize: function(windowName) {
        state.minimizedWindows[windowName] = !state.minimizedWindows[windowName];
        
        let windowElement;
        let contentElement;
        
        switch (windowName) {
          case 'mainWindow':
            windowElement = document.getElementById('form-designer');
            contentElement = document.getElementById('designer-canvas');
            break;
          case 'propertyWindow':
            windowElement = document.getElementById('properties-window');
            contentElement = windowElement.querySelector('.properties-grid').parentElement;
            break;
          case 'projectWindow':
            windowElement = document.getElementById('project-explorer');
            contentElement = windowElement.querySelector('div[style*="padding: 2px"]');
            break;
          case 'codeWindow':
            windowElement = document.getElementById('code-window');
            contentElement = windowElement.querySelector('.code-editor');
            break;
          case 'toolbox':
            windowElement = document.getElementById('toolbox');
            contentElement = document.getElementById('toolbox-container');
            break;
        }
        
        if (windowElement && contentElement) {
          contentElement.style.display = state.minimizedWindows[windowName] ? 'none' : 'block';
          windowElement.style.height = state.minimizedWindows[windowName] ? '18px' : windowElement.getAttribute('data-original-height') || windowElement.style.height;
        }
      },
      
      toggleVisibility: function(windowName) {
        state.visibleWindows[windowName] = !state.visibleWindows[windowName];
        
        let windowElement;
        
        switch (windowName) {
          case 'mainWindow':
            windowElement = document.getElementById('form-designer');
            break;
          case 'propertyWindow':
            windowElement = document.getElementById('properties-window');
            break;
          case 'projectWindow':
            windowElement = document.getElementById('project-explorer');
            break;
          case 'codeWindow':
            windowElement = document.getElementById('code-window');
            break;
          case 'toolbox':
            windowElement = document.getElementById('toolbox');
            break;
        }
        
        if (windowElement) {
          windowElement.style.display = state.visibleWindows[windowName] ? 'block' : 'none';
        }
      },
      
      saveWindowSizes: function() {
        const windowElements = [
          { el: document.getElementById('form-designer'), name: 'mainWindow' },
          { el: document.getElementById('properties-window'), name: 'propertyWindow' },
          { el: document.getElementById('project-explorer'), name: 'projectWindow' },
          { el: document.getElementById('code-window'), name: 'codeWindow' },
          { el: document.getElementById('toolbox'), name: 'toolbox' }
        ];
        
        windowElements.forEach(item => {
          if (item.el) {
            item.el.setAttribute('data-original-height', item.el.style.height);
          }
        });
      }
    };
    
    // Menu System
    const menuSystem = {
      activeMenu: null,
      
      init: function() {
        const menuButtons = document.querySelectorAll('[data-menu]');
        
        menuButtons.forEach(button => {
          button.addEventListener('click', (e) => {
            const menuId = button.getAttribute('data-menu');
            this.toggleMenu(menuId, e);
          });
        });
        
        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
          if (!e.target.closest('[data-menu]') && !e.target.closest('.menu-dropdown')) {
            this.closeAllMenus();
          }
        });
        
        // Initialize menu item handlers
        this.initMenuHandlers();
      },
      
      toggleMenu: function(menuId, event) {
        this.closeAllMenus();
        
        const menu = document.getElementById(menuId);
        if (!menu) return;
        
        // Position the menu below the button
        const buttonRect = event.target.getBoundingClientRect();
        menu.style.top = `${buttonRect.bottom}px`;
        menu.style.left = `${buttonRect.left}px`;
        
        menu.classList.add('show');
        this.activeMenu = menu;
        
        event.stopPropagation();
      },
      
      closeAllMenus: function() {
        document.querySelectorAll('.menu-dropdown').forEach(menu => {
          menu.classList.remove('show');
        });
        this.activeMenu = null;
      },
      
      initMenuHandlers: function() {
        // File menu handlers
        document.getElementById('file-new').addEventListener('click', () => {
          document.getElementById('new-project-dialog').style.display = 'flex';
          this.closeAllMenus();
        });
        
        document.getElementById('file-open').addEventListener('click', () => {
          document.getElementById('open-project-dialog').style.display = 'flex';
          this.closeAllMenus();
        });
        
        document.getElementById('file-save').addEventListener('click', () => {
          toast.show('Project saved');
          state.projectIsDirty = false;
          document.getElementById('status-saved').textContent = 'Saved';
          this.closeAllMenus();
        });
        
        document.getElementById('file-exit').addEventListener('click', () => {
          if (state.projectIsDirty) {
            if (confirm('Do you want to save changes to Project1?')) {
              toast.show('Project saved');
            }
          }
          toast.show('Visual Basic is closing...');
          this.closeAllMenus();
        });
        
        // Edit menu handlers
        document.getElementById('edit-delete').addEventListener('click', () => {
          if (state.selectedControlId) {
            document.getElementById('delete-control-dialog').style.display = 'flex';
          } else {
            toast.show('No control selected');
          }
          this.closeAllMenus();
        });
        
        // View menu handlers
        document.getElementById('view-code').addEventListener('click', () => {
          if (state.selectedControlId) {
            controlsManager.openCodeWindow(state.selectedControlId);
          } else {
            controlsManager.openFormCodeWindow();
          }
          this.closeAllMenus();
        });
        
        document.getElementById('view-object').addEventListener('click', () => {
          if (state.visibleWindows.codeWindow) {
            windows.toggleVisibility('codeWindow');
          }
          windows.toggleVisibility('mainWindow');
          document.getElementById('form-designer').style.zIndex = windows.getHighestZIndex() + 1;
          this.closeAllMenus();
        });
        
        document.getElementById('view-project-explorer').addEventListener('click', () => {
          windows.toggleVisibility('projectWindow');
          this.closeAllMenus();
        });
        
        document.getElementById('view-properties-window').addEventListener('click', () => {
          windows.toggleVisibility('propertyWindow');
          this.closeAllMenus();
        });
        
        document.getElementById('view-toolbox').addEventListener('click', () => {
          windows.toggleVisibility('toolbox');
          this.closeAllMenus();
        });
        
        // Run menu handlers
        document.getElementById('run-start').addEventListener('click', () => {
          controlsManager.runProject();
          this.closeAllMenus();
        });
        
        document.getElementById('run-break').addEventListener('click', () => {
          if (state.isRunning) {
            toast.show('Break mode');
          } else {
            toast.show('Project not running');
          }
          this.closeAllMenus();
        });
        
        document.getElementById('run-end').addEventListener('click', () => {
          if (state.isRunning) {
            controlsManager.stopProject();
          } else {
            toast.show('Project not running');
          }
          this.closeAllMenus();
        });
        
        // Help menu handlers
        document.getElementById('help-about').addEventListener('click', () => {
          document.getElementById('about-dialog').style.display = 'flex';
          this.closeAllMenus();
        });
      }
    };
    
    // Controls Manager (for Designer Canvas)
    const controlsManager = {
      canvas: document.getElementById('designer-canvas'),
      nextControlId: 1,
      activeToolId: 'pointer-tool',
      
      init: function() {
        // Set up canvas drag listeners
        this.canvas.addEventListener('click', (e) => {
          if (e.target === this.canvas) {
            if (this.activeToolId !== 'pointer-tool') {
              this.addControlToCanvas(this.activeToolId.replace('-tool', ''), 
                e.clientX - this.canvas.getBoundingClientRect().left, 
                e.clientY - this.canvas.getBoundingClientRect().top);
            } else {
              this.selectControl(null);
            }
          }
        });
        
        // Initialize toolbar items in toolbox
        const toolboxButtons = document.querySelectorAll('#toolbox .toolbar-btn');
        toolboxButtons.forEach(button => {
          button.addEventListener('click', () => {
            this.setActiveTool(button.id);
          });
        });
        
        // Set up key handler for deleting controls
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Delete' && state.selectedControlId) {
            document.getElementById('delete-control-dialog').style.display = 'flex';
          }
        });
        
        // Initialize canvas grid
        this.initializeGrid();
        
        // Set pointer as default tool
        this.setActiveTool('pointer-tool');
      },
      
      setActiveTool: function(toolId) {
        // Reset all tools
        document.querySelectorAll('#toolbox .toolbar-btn').forEach(btn => {
          btn.style.backgroundColor = '#D4D0C8';
          btn.style.borderColor = 'transparent';
        });
        
        // Set active tool
        this.activeToolId = toolId;
        
        // Highlight active tool button
        const activeBtn = document.getElementById(toolId);
        if (activeBtn) {
          activeBtn.style.backgroundColor = '#D4D0C8';
          activeBtn.style.border = '1px solid';
          activeBtn.style.borderColor = '#808080 #FFFFFF #FFFFFF #808080';
        }
      },
      
      initializeGrid: function() {
        const gridSize = 8; // 8 pixels for grid (120 twips at 96 DPI)
        const width = this.canvas.offsetWidth;
        const height = this.canvas.offsetHeight;
        
        for (let y = 0; y < Math.floor(height / gridSize); y++) {
          for (let x = 0; x < Math.floor(width / gridSize); x++) {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            cell.style.left = `${x * gridSize}px`;
            cell.style.top = `${y * gridSize}px`;
            cell.style.width = `${gridSize}px`;
            cell.style.height = `${gridSize}px`;
            this.canvas.appendChild(cell);
          }
        }
      },
      
      snapToGridValue: function(value) {
        if (!state.snapToGrid) return value;
        
        const gridPixels = 8; // Grid size in pixels
        return Math.round(value / gridPixels) * gridPixels;
      },
      
      addControlToCanvas: function(controlType, x, y) {
        if (!state.isInDesignMode) return;
        
        const cleanType = controlType.replace(/-/g, '');
        const controlId = `${cleanType}${this.nextControlId++}`;
        const snappedX = this.snapToGridValue(x);
        const snappedY = this.snapToGridValue(y);
        const defaultProps = this.getDefaultProperties(cleanType, snappedX, snappedY);
        
        const control = {
          id: controlId,
          type: cleanType,
          properties: defaultProps
        };
        
        state.controls.push(control);
        this.renderControl(control);
        this.selectControl(controlId);
        
        // Reset the active tool to pointer after adding a control
        if (this.activeToolId !== 'pointer-tool') {
          this.setActiveTool('pointer-tool');
        }
        
        // Create default event handler code for the control
        const eventHandler = this.getDefaultEventHandler(control);
        if (eventHandler) {
          state.controlCode[controlId] = eventHandler;
        }
        
        state.projectIsDirty = true;
        document.getElementById('status-saved').textContent = 'Modified';
        
        toast.show(`${cleanType} control added to form`);
      },
      
      getDefaultEventHandler: function(control) {
        let eventType = '';
        switch(control.type) {
          case 'commandbutton':
            eventType = 'Click';
            break;
          case 'textbox':
            eventType = 'Change';
            break;
          case 'checkbox':
          case 'optionbutton':
            eventType = 'Click';
            break;
          case 'combobox':
          case 'listbox':
            eventType = 'Change';
            break;
          default:
            return null;
        }
        
        return `' Event handler for ${control.properties.name}
Private Sub ${control.properties.name}_${eventType}()
  ' Add your code here
  
End Sub
`;
      },
      
      getDefaultProperties: function(type, x, y) {
        const baseProps = {
          name: `${type}${this.nextControlId}`,
          left: x,
          top: y,
          visible: true,
          enabled: true,
          index: this.nextControlId - 1
        };
        
        switch (type) {
          case 'commandbutton':
            return {
              ...baseProps,
              width: 96,  // Standard VB6 command button width (1440 twips ÷ 15 twips/pixel = 96 pixels)
              height: 24, // Standard VB6 command button height (375 twips ÷ 15 twips/pixel = 25 pixels)
              caption: `Command${this.nextControlId}`
            };
          case 'textbox':
            return {
              ...baseProps,
              width: 120,
              height: 20,
              text: '',
              multiline: false
            };
          case 'label':
            return {
              ...baseProps,
              width: 72,
              height: 16,
              caption: `Label${this.nextControlId}`,
              autosize: false,
              alignment: 0 // 0=Left, 1=Right, 2=Center
            };
          case 'checkbox':
            return {
              ...baseProps,
              width: 96,
              height: 16,
              caption: `Check${this.nextControlId}`,
              value: false
            };
          case 'optionbutton':
            return {
              ...baseProps,
              width: 96,
              height: 16,
              caption: `Option${this.nextControlId}`,
              value: false
            };
          case 'combobox':
            return {
              ...baseProps,
              width: 120,
              height: 21,
              text: '',
              style: 0, // 0=Dropdown Combo, 1=Simple Combo, 2=Dropdown List
              items: ['Item1', 'Item2', 'Item3']
            };
          case 'listbox':
            return {
              ...baseProps,
              width: 120,
              height: 80,
              items: ['Item1', 'Item2', 'Item3'],
              multiselect: false
            };
          case 'frame':
            return {
              ...baseProps,
              width: 168,
              height: 120,
              caption: `Frame${this.nextControlId}`
            };
          default:
            return {
              ...baseProps,
              width: 96,
              height: 24
            };
        }
      },
      
      renderControl: function(control) {
        // Remove existing control if it exists
        const existingControl = document.getElementById(control.id);
        if (existingControl) {
          existingControl.remove();
        }
        
        // Create control element
        const controlEl = document.createElement('div');
        controlEl.id = control.id;
        controlEl.className = 'control';
        if (control.id === state.selectedControlId) {
          controlEl.classList.add('selected');
        }
        
        // Set position and dimensions
        controlEl.style.left = `${control.properties.left}px`;
        controlEl.style.top = `${control.properties.top}px`;
        controlEl.style.width = `${control.properties.width}px`;
        controlEl.style.height = `${control.properties.height}px`;
        
        // Set visibility and enabled state
        if (!control.properties.visible) {
          controlEl.style.display = 'none';
        }
        if (!control.properties.enabled) {
          controlEl.style.opacity = '0.6';
        }
        
        // Set control-specific properties
        switch (control.type) {
          case 'commandbutton':
            controlEl.className += ' command-button';
            controlEl.textContent = control.properties.caption;
            controlEl.style.display = 'flex';
            controlEl.style.alignItems = 'center';
            controlEl.style.justifyContent = 'center';
            
            if (!state.isInDesignMode) {
              controlEl.addEventListener('click', () => {
                toast.show(`Button clicked: ${control.properties.name}`);
                this.executeCode(control.id, 'Click');
              });
            }
            break;
            
          case 'textbox':
            controlEl.className += ' text-box';
            const textInput = document.createElement('input');
            textInput.type = 'text';
            textInput.value = control.properties.text || '';
            textInput.style.width = '100%';
            textInput.style.height = '100%';
            textInput.style.border = 'none';
            textInput.style.padding = '2px';
            textInput.style.backgroundColor = control.properties.backcolor || 'white';
            textInput.disabled = state.isInDesignMode;
            
            if (!state.isInDesignMode) {
              textInput.addEventListener('change', () => {
                this.updateControlProperty(control.id, 'text', textInput.value);
                this.executeCode(control.id, 'Change');
              });
            }
            
            controlEl.appendChild(textInput);
            break;
            
          case 'label':
            controlEl.className += ' label';
            controlEl.innerHTML = control.properties.caption || '';
            controlEl.style.display = 'flex';
            controlEl.style.alignItems = 'center';
            
            // Set alignment
            if (control.properties.alignment === 1) { // Right
              controlEl.style.justifyContent = 'flex-end';
            } else if (control.properties.alignment === 2) { // Center
              controlEl.style.justifyContent = 'center';
            }
            
            // If autosize is enabled, adjust width to text
            if (control.properties.autosize) {
              const tempSpan = document.createElement('span');
              tempSpan.style.visibility = 'hidden';
              tempSpan.style.position = 'absolute';
              tempSpan.style.fontFamily = 'Tahoma, sans-serif';
              tempSpan.style.fontSize = '11px';
              tempSpan.textContent = control.properties.caption;
              document.body.appendChild(tempSpan);
              
              const width = tempSpan.offsetWidth + 4;
              control.properties.width = width;
              controlEl.style.width = `${width}px`;
              
              document.body.removeChild(tempSpan);
            }
            break;
            
          case 'checkbox':
            controlEl.className += ' checkbox';
            const checkContainer = document.createElement('div');
            checkContainer.style.display = 'flex';
            checkContainer.style.alignItems = 'center';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.style.marginRight = '4px';
            checkbox.checked = control.properties.value || false;
            checkbox.disabled = state.isInDesignMode;
            
            const checkLabel = document.createElement('span');
            checkLabel.textContent = control.properties.caption;
            
            checkContainer.appendChild(checkbox);
            checkContainer.appendChild(checkLabel);
            controlEl.appendChild(checkContainer);
            
            if (!state.isInDesignMode) {
              checkbox.addEventListener('change', () => {
                this.updateControlProperty(control.id, 'value', checkbox.checked);
                this.executeCode(control.id, 'Click');
              });
            }
            break;
            
          case 'optionbutton':
            controlEl.className += ' option-button';
            const radioContainer = document.createElement('div');
            radioContainer.style.display = 'flex';
            radioContainer.style.alignItems = 'center';
            
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'optionGroup';
            radio.style.marginRight = '4px';
            radio.checked = control.properties.value || false;
            radio.disabled = state.isInDesignMode;
            
            const radioLabel = document.createElement('span');
            radioLabel.textContent = control.properties.caption;
            
            radioContainer.appendChild(radio);
            radioContainer.appendChild(radioLabel);
            controlEl.appendChild(radioContainer);
            
            if (!state.isInDesignMode) {
              radio.addEventListener('change', () => {
                // Unselect all other option buttons in the same group
                state.controls.forEach(c => {
                  if (c.type === 'optionbutton' && c.id !== control.id) {
                    this.updateControlProperty(c.id, 'value', false);
                  }
                });
                
                this.updateControlProperty(control.id, 'value', true);
                this.executeCode(control.id, 'Click');
              });
            }
            break;
            
          case 'combobox':
            controlEl.className += ' combobox';
            const comboBox = document.createElement('select');
            comboBox.style.width = '100%';
            comboBox.style.height = '100%';
            comboBox.style.border = 'none';
            comboBox.disabled = state.isInDesignMode;
            
            if (control.properties.style !== 2) { // Not Dropdown List
              const defaultOption = document.createElement('option');
              defaultOption.textContent = control.properties.text || '';
              defaultOption.value = '';
              comboBox.appendChild(defaultOption);
            }
            
            (control.properties.items || []).forEach(item => {
              const option = document.createElement('option');
              option.textContent = item;
              option.value = item;
              comboBox.appendChild(option);
            });
            
            controlEl.appendChild(comboBox);
            
            if (!state.isInDesignMode) {
              comboBox.addEventListener('change', () => {
                if (control.properties.style !== 2) { // Not Dropdown List
                  this.updateControlProperty(control.id, 'text', comboBox.value);
                }
                this.updateControlProperty(control.id, 'selectedItem', comboBox.value);
                this.executeCode(control.id, 'Change');
              });
            }
            break;
            
          case 'listbox':
            controlEl.className += ' list-box';
            const listBox = document.createElement('select');
            listBox.multiple = control.properties.multiselect || false;
            listBox.style.width = '100%';
            listBox.style.height = '100%';
            listBox.style.border = 'none';
            listBox.disabled = state.isInDesignMode;
            
            (control.properties.items || []).forEach(item => {
              const option = document.createElement('option');
              option.textContent = item;
              option.value = item;
              listBox.appendChild(option);
            });
            
            controlEl.appendChild(listBox);
            
            if (!state.isInDesignMode) {
              listBox.addEventListener('change', () => {
                const selectedItems = Array.from(listBox.selectedOptions).map(option => option.value);
                this.updateControlProperty(control.id, 'selectedItems', selectedItems);
                this.executeCode(control.id, 'Change');
              });
            }
            break;
            
          case 'frame':
            controlEl.className += ' frame';
            
            const frameTitle = document.createElement('div');
            frameTitle.textContent = control.properties.caption;
            frameTitle.style.position = 'absolute';
            frameTitle.style.top = '-9px';
            frameTitle.style.left = '8px';
            frameTitle.style.backgroundColor = '#D4D0C8';
            frameTitle.style.padding = '0 4px';
            frameTitle.style.fontSize = '11px';
            frameTitle.style.fontFamily = 'Tahoma, sans-serif';
            
            controlEl.appendChild(frameTitle);
            break;
        }
        
        // Add resize handle if selected
        if (control.id === state.selectedControlId && state.isInDesignMode) {
          const resizeHandle = document.createElement('div');
          resizeHandle.className = 'resize-handle';
          controlEl.appendChild(resizeHandle);
          
          this.makeControlResizable(controlEl, resizeHandle, control.id);
        }
        
        // Make control draggable in design mode
        if (state.isInDesignMode) {
          this.makeControlDraggable(controlEl, control.id);
        }
        
        // Add select handler
        controlEl.addEventListener('mousedown', (e) => {
          if (state.isInDesignMode) {
            this.selectControl(control.id);
            e.stopPropagation();
          }
        });
        
        // Add double-click handler to open code window
        controlEl.addEventListener('dblclick', () => {
          if (state.isInDesignMode) {
            this.openCodeWindow(control.id);
          }
        });
        
        this.canvas.appendChild(controlEl);
      },
      
      makeControlDraggable: function(controlEl, controlId) {
        let isDragging = false;
        let startX, startY;
        let startLeft, startTop;
        
        controlEl.addEventListener('mousedown', (e) => {
          if (!state.isInDesignMode) return;
          
          isDragging = true;
          startX = e.clientX;
          startY = e.clientY;
          
          const control = state.controls.find(c => c.id === controlId);
          if (control) {
            startLeft = control.properties.left;
            startTop = control.properties.top;
          }
          
          e.stopPropagation();
        });
        
        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          
          const deltaX = e.clientX - startX;
          const deltaY = e.clientY - startY;
          
          let newLeft = startLeft + deltaX;
          let newTop = startTop + deltaY;
          
          // Snap to grid if enabled
          if (state.snapToGrid) {
            newLeft = this.snapToGridValue(newLeft);
            newTop = this.snapToGridValue(newTop);
          }
          
          this.updateControlProperty(controlId, 'left', newLeft);
          this.updateControlProperty(controlId, 'top', newTop);
        });
        
        document.addEventListener('mouseup', () => {
          isDragging = false;
        });
      },
      
      makeControlResizable: function(controlEl, resizeHandle, controlId) {
        let isResizing = false;
        let startX, startY;
        let startWidth, startHeight;
        
        resizeHandle.addEventListener('mousedown', (e) => {
          if (!state.isInDesignMode) return;
          
          isResizing = true;
          startX = e.clientX;
          startY = e.clientY;
          
          const control = state.controls.find(c => c.id === controlId);
          if (control) {
            startWidth = control.properties.width;
            startHeight = control.properties.height;
          }
          
          e.stopPropagation();
        });
        
        document.addEventListener('mousemove', (e) => {
          if (!isResizing) return;
          
          const deltaX = e.clientX - startX;
          const deltaY = e.clientY - startY;
          
          let newWidth = Math.max(8, startWidth + deltaX);
          let newHeight = Math.max(8, startHeight + deltaY);
          
          // Snap to grid if enabled
          if (state.snapToGrid) {
            newWidth = this.snapToGridValue(newWidth);
            newHeight = this.snapToGridValue(newHeight);
          }
          
          this.updateControlProperty(controlId, 'width', newWidth);
          this.updateControlProperty(controlId, 'height', newHeight);
        });
        
        document.addEventListener('mouseup', () => {
          isResizing = false;
        });
      },
      
      selectControl: function(controlId) {
        const prevSelectedId = state.selectedControlId;
        state.selectedControlId = controlId;
        
        // Update previous selected control
        if (prevSelectedId) {
          const prevControl = state.controls.find(c => c.id === prevSelectedId);
          if (prevControl) {
            this.renderControl(prevControl);
          }
        }
        
        // Update newly selected control
        if (controlId) {
          const control = state.controls.find(c => c.id === controlId);
          if (control) {
            this.renderControl(control);
            propertiesWindow.showControlProperties(control);
            document.getElementById('properties-title-bar').querySelector('.win98-title').textContent = `Properties - ${control.properties.name}`;
          }
        } else {
          propertiesWindow.showFormProperties();
          document.getElementById('properties-title-bar').querySelector('.win98-title').textContent = `Properties - Form1`;
        }
        
        // Update status bar
        document.getElementById('status-selection').textContent = controlId ? 
          state.controls.find(c => c.id === controlId)?.properties.name || controlId : 'Form1';
      },
      
      updateControlProperty: function(controlId, property, value) {
        const controlIndex = state.controls.findIndex(c => c.id === controlId);
        if (controlIndex === -1) return;
        
        state.controls[controlIndex].properties[property] = value;
        this.renderControl(state.controls[controlIndex]);
        
        if (state.selectedControlId === controlId) {
          propertiesWindow.showControlProperties(state.controls[controlIndex]);
        }
        
        state.projectIsDirty = true;
        document.getElementById('status-saved').textContent = 'Modified';
      },
      
      deleteSelectedControl: function() {
        if (!state.selectedControlId) return;
        
        const controlIndex = state.controls.findIndex(c => c.id === state.selectedControlId);
        if (controlIndex === -1) return;
        
        const controlEl = document.getElementById(state.selectedControlId);
        if (controlEl) {
          controlEl.remove();
        }
        
        // Remove the control's code
        delete state.controlCode[state.selectedControlId];
        
        state.controls.splice(controlIndex, 1);
        state.selectedControlId = null;
        propertiesWindow.showFormProperties();
        
        document.getElementById('status-selection').textContent = 'Form1';
        document.getElementById('properties-title-bar').querySelector('.win98-title').textContent = `Properties - Form1`;
        
        state.projectIsDirty = true;
        document.getElementById('status-saved').textContent = 'Modified';
        
        toast.show('Control deleted');
      },
      
      openCodeWindow: function(controlId) {
        state.currentCodeControlId = controlId;
        state.visibleWindows.codeWindow = true;
        
        const codeWindow = document.getElementById('code-window');
        codeWindow.style.display = 'block';
        codeWindow.style.zIndex = windows.getHighestZIndex() + 1;
        
        const control = state.controls.find(c => c.id === controlId);
        if (control) {
          let eventType = 'Click';
          if (control.type === 'textbox' || control.type === 'combobox' || control.type === 'listbox') {
            eventType = 'Change';
          }
          
          // Get existing code or create default template
          let codeContent = state.controlCode[controlId] || `' Event handler for ${control.properties.name}
Private Sub ${control.properties.name}_${eventType}()
  ' Add your code here
  
End Sub
`;
          
          document.getElementById('code-textarea').value = codeContent;
          document.getElementById('code-window-title-bar').querySelector('.win98-title').textContent = `${control.properties.name} (Code)`;
        }
      },
      
      openFormCodeWindow: function() {
        state.currentCodeControlId = 'Form1';
        state.visibleWindows.codeWindow = true;
        
        const codeWindow = document.getElementById('code-window');
        codeWindow.style.display = 'block';
        codeWindow.style.zIndex = windows.getHighestZIndex() + 1;
        
        // Get existing code or create default template
        let codeContent = state.controlCode['Form1'] || `' Code for Form1

Option Explicit

Private Sub Form_Load()
  ' Initialize form
  Me.Caption = "Form1"
End Sub

Private Sub Form_Click()
  ' Add your code here
  MsgBox "Form clicked!"
End Sub
`;
        
        document.getElementById('code-textarea').value = codeContent;
        document.getElementById('code-window-title-bar').querySelector('.win98-title').textContent = `Form1 (Code)`;
      },
      
      saveCurrentCode: function() {
        if (state.currentCodeControlId) {
          const codeContent = document.getElementById('code-textarea').value;
          state.controlCode[state.currentCodeControlId] = codeContent;
          
          state.projectIsDirty = true;
          document.getElementById('status-saved').textContent = 'Modified';
          toast.show('Code saved');
        }
      },
      
      executeCode: function(controlId, eventType) {
        if (!state.isRunning) return;
        
        const control = state.controls.find(c => c.id === controlId);
        if (!control) return;
        
        const codeContent = state.controlCode[controlId] || '';
        
        // Very simple "execution" of the code - just show what would happen
        toast.show(`Executing ${control.properties.name}_${eventType}()`);
        
        // Check if the code contains a MsgBox call and simulate it
        const msgBoxMatch = codeContent.match(/MsgBox\s+"(.+?)"/);
        if (msgBoxMatch && msgBoxMatch[1]) {
          setTimeout(() => {
            alert(msgBoxMatch[1]);
          }, 100);
        }
      },
      
      runProject: function() {
        if (state.isRunning) return;
        
        // Save any open code
        this.saveCurrentCode();
        
        // Hide code window if open
        if (state.visibleWindows.codeWindow) {
          windows.toggleVisibility('codeWindow');
        }
        
        state.isInDesignMode = false;
        state.isRunning = true;
        
        document.getElementById('status-mode').textContent = 'Running...';
        document.getElementById('toolbar').querySelectorAll('.toolbar-btn').forEach(btn => {
          if (btn.id === 'break-btn' || btn.id === 'end-btn') {
            btn.style.backgroundColor = '#D4D0C8';
          } else {
            btn.style.opacity = '0.5';
          }
        });
        
        // Re-render all controls for run mode
        state.controls.forEach(control => {
          this.renderControl(control);
        });
        
        // Simulate Form_Load event
        this.executeCode('Form1', 'Load');
        
        toast.show('Project running');
      },
      
      stopProject: function() {
        if (!state.isRunning) return;
        
        state.isInDesignMode = true;
        state.isRunning = false;
        
        document.getElementById('status-mode').textContent = 'Design';
        document.getElementById('toolbar').querySelectorAll('.toolbar-btn').forEach(btn => {
          btn.style.opacity = '1';
        });
        
        // Re-render all controls for design mode
        state.controls.forEach(control => {
          this.renderControl(control);
        });
        
        // If a control was selected, re-select it
        if (state.selectedControlId) {
          this.selectControl(state.selectedControlId);
        }
        
        toast.show('Project stopped');
      }
    };
    
    // Properties Window
    const propertiesWindow = {
      propertiesGrid: document.getElementById('properties-grid'),
      noSelectionMessage: document.getElementById('no-selection'),
      
      init: function() {
        // Initialize tab switching
        document.getElementById('properties-tab-alphabetic').addEventListener('click', () => {
          document.getElementById('properties-tab-alphabetic').classList.add('active');
          document.getElementById('properties-tab-categorized').classList.remove('active');
        });
        
        document.getElementById('properties-tab-categorized').addEventListener('click', () => {
          document.getElementById('properties-tab-categorized').classList.add('active');
          document.getElementById('properties-tab-alphabetic').classList.remove('active');
        });
        
        // Show form properties by default
        this.showFormProperties();
      },
      
      showControlProperties: function(control) {
        this.propertiesGrid.innerHTML = '';
        this.propertiesGrid.style.display = 'grid';
        this.noSelectionMessage.style.display = 'none';
        
        const properties = control.properties;
        const sortedProps = Object.keys(properties).sort();
        
        for (const key of sortedProps) {
          const value = properties[key];
          this.addPropertyRow(key, value, control.id);
        }
      },
      
      showFormProperties: function() {
        this.propertiesGrid.innerHTML = '';
        this.propertiesGrid.style.display = 'grid';
        this.noSelectionMessage.style.display = 'none';
        
        // Add standard form properties
        const formProps = {
          BackColor: '&H8000000F&',
          Caption: 'Form1',
          ClientHeight: 3600,
          ClientLeft: 60,
          ClientTop: 345,
          ClientWidth: 4680,
          Height: 4005,
          Left: 0,
          Name: 'Form1',
          ScaleHeight: 3600,
          ScaleWidth: 4680,
          Top: 0,
          Width: 4800
        };
        
        const sortedProps = Object.keys(formProps).sort();
        
        for (const key of sortedProps) {
          const value = formProps[key];
          this.addPropertyRow(key, value, 'Form1');
        }
      },
      
      addPropertyRow: function(key, value, controlId) {
        const propertyName = document.createElement('div');
        propertyName.className = 'property-name';
        propertyName.textContent = key;
        
        const propertyValue = document.createElement('div');
        propertyValue.className = 'property-value';
        
        // Create appropriate input for property type
        if (typeof value === 'boolean') {
          const select = document.createElement('select');
          select.style.width = '100%';
          
          const trueOption = document.createElement('option');
          trueOption.textContent = 'True';
          trueOption.value = 'true';
          trueOption.selected = value === true;
          
          const falseOption = document.createElement('option');
          falseOption.textContent = 'False';
          falseOption.value = 'false';
          falseOption.selected = value === false;
          
          select.appendChild(trueOption);
          select.appendChild(falseOption);
          
          select.addEventListener('change', () => {
            const newValue = select.value === 'true';
            controlsManager.updateControlProperty(controlId, key, newValue);
          });
          
          propertyValue.appendChild(select);
        } else if (typeof value === 'number') {
          const input = document.createElement('input');
          input.type = 'text';
          input.value = value;
          
          input.addEventListener('change', () => {
            controlsManager.updateControlProperty(controlId, key, Number(input.value));
          });
          
          propertyValue.appendChild(input);
        } else if (Array.isArray(value)) {
          const input = document.createElement('input');
          input.type = 'text';
          input.value = value.join(',');
          
          input.addEventListener('change', () => {
            const items = input.value.split(',').map(item => item.trim());
            controlsManager.updateControlProperty(controlId, key, items);
          });
          
          propertyValue.appendChild(input);
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.value = value || '';
          
          input.addEventListener('change', () => {
            controlsManager.updateControlProperty(controlId, key, input.value);
          });
          
          propertyValue.appendChild(input);
        }
        
        this.propertiesGrid.appendChild(propertyName);
        this.propertiesGrid.appendChild(propertyValue);
      },
      
      hideControlProperties: function() {
        this.propertiesGrid.style.display = 'none';
        this.noSelectionMessage.style.display = 'block';
      }
    };
    
    // Project Explorer
    const projectExplorer = {
      init: function() {
        // Make project clickable
        const projectItems = document.querySelectorAll('.project-explorer-item');
        projectItems.forEach(item => {
          item.addEventListener('click', (e) => {
            e.stopPropagation();
            
            if (item.classList.contains('project-folder')) {
              const childContainer = item.querySelector('div');
              if (childContainer) {
                childContainer.style.display = childContainer.style.display === 'none' ? 'block' : 'none';
              }
            } else if (item.classList.contains('project-file')) {
              const fileType = item.getAttribute('data-file');
              if (fileType && fileType.endsWith('.frm')) {
                windows.toggleVisibility('mainWindow');
                document.getElementById('form-designer').style.zIndex = windows.getHighestZIndex() + 1;
              } else {
                toast.show(`Opening ${fileType}`);
              }
            }
          });
        });
      }
    };
    
    // Dialog Management
    const dialogManager = {
      init: function() {
        // About dialog
        document.getElementById('about-dialog-close').addEventListener('click', () => {
          document.getElementById('about-dialog').style.display = 'none';
        });
        
        document.getElementById('about-dialog-ok').addEventListener('click', () => {
          document.getElementById('about-dialog').style.display = 'none';
        });
        
        // New Project dialog
        document.getElementById('new-project-dialog-close').addEventListener('click', () => {
          document.getElementById('new-project-dialog').style.display = 'none';
        });
        
        document.getElementById('new-project-dialog-cancel').addEventListener('click', () => {
          document.getElementById('new-project-dialog').style.display = 'none';
        });
        
        document.getElementById('new-project-dialog-ok').addEventListener('click', () => {
          toast.show('New Standard EXE project created');
          document.getElementById('new-project-dialog').style.display = 'none';
        });
        
        // Open Project dialog
        document.getElementById('open-project-dialog-close').addEventListener('click', () => {
          document.getElementById('open-project-dialog').style.display = 'none';
        });
        
        document.getElementById('open-project-dialog-cancel').addEventListener('click', () => {
          document.getElementById('open-project-dialog').style.display = 'none';
        });
        
        document.getElementById('open-project-dialog-open').addEventListener('click', () => {
          toast.show('Project opened');
          document.getElementById('open-project-dialog').style.display = 'none';
        });
        
        // Delete Control dialog
        document.getElementById('delete-control-dialog-close').addEventListener('click', () => {
          document.getElementById('delete-control-dialog').style.display = 'none';
        });
        
        document.getElementById('delete-control-dialog-no').addEventListener('click', () => {
          document.getElementById('delete-control-dialog').style.display = 'none';
        });
        
        document.getElementById('delete-control-dialog-yes').addEventListener('click', () => {
          controlsManager.deleteSelectedControl();
          document.getElementById('delete-control-dialog').style.display = 'none';
        });
      }
    };
    
    // Window Control Handlers
    function initWindowControls() {
      // Form Designer Window
      windows.makeWindowDraggable(
        document.getElementById('form-designer'),
        document.getElementById('form-designer-title-bar')
      );
      
      document.getElementById('form-designer-minimize').addEventListener('click', () => {
        windows.toggleMinimize('mainWindow');
      });
      
      document.getElementById('form-designer-close').addEventListener('click', () => {
        windows.toggleVisibility('mainWindow');
      });
      
      // Project Explorer Window
      windows.makeWindowDraggable(
        document.getElementById('project-explorer'),
        document.getElementById('project-explorer-title-bar')
      );
      
      document.getElementById('project-explorer-minimize').addEventListener('click', () => {
        windows.toggleMinimize('projectWindow');
      });
      
      document.getElementById('project-explorer-close').addEventListener('click', () => {
        windows.toggleVisibility('projectWindow');
      });
      
      // Properties Window
      windows.makeWindowDraggable(
        document.getElementById('properties-window'),
        document.getElementById('properties-title-bar')
      );
      
      document.getElementById('properties-minimize').addEventListener('click', () => {
        windows.toggleMinimize('propertyWindow');
      });
      
      document.getElementById('properties-close').addEventListener('click', () => {
        windows.toggleVisibility('propertyWindow');
      });
      
      // Code Window
      windows.makeWindowDraggable(
        document.getElementById('code-window'),
        document.getElementById('code-window-title-bar')
      );
      
      document.getElementById('code-window-minimize').addEventListener('click', () => {
        windows.toggleMinimize('codeWindow');
      });
      
      document.getElementById('code-window-close').addEventListener('click', () => {
        // Save code before closing
        controlsManager.saveCurrentCode();
        windows.toggleVisibility('codeWindow');
      });
      
      // Toolbox Window
      windows.makeWindowDraggable(
        document.getElementById('toolbox'),
        document.getElementById('toolbox-title-bar')
      );
      
      document.getElementById('toolbox-minimize').addEventListener('click', () => {
        windows.toggleMinimize('toolbox');
      });
      
      document.getElementById('toolbox-close').addEventListener('click', () => {
        windows.toggleVisibility('toolbox');
      });
    }
    
    // Toolbar Button Handlers
    function initToolbarButtons() {
      document.getElementById('new-btn').addEventListener('click', () => {
        document.getElementById('new-project-dialog').style.display = 'flex';
      });
      
      document.getElementById('open-btn').addEventListener('click', () => {
        document.getElementById('open-project-dialog').style.display = 'flex';
      });
      
      document.getElementById('save-btn').addEventListener('click', () => {
        // Save any open code first
        controlsManager.saveCurrentCode();
        
        toast.show('Project saved');
        state.projectIsDirty = false;
        document.getElementById('status-saved').textContent = 'Saved';
      });
      
      document.getElementById('run-btn').addEventListener('click', () => {
        if (!state.isRunning) {
          controlsManager.runProject();
        }
      });
      
      document.getElementById('break-btn').addEventListener('click', () => {
        if (state.isRunning) {
          toast.show('Break mode');
        }
      });
      
      document.getElementById('end-btn').addEventListener('click', () => {
        if (state.isRunning) {
          controlsManager.stopProject();
        }
      });
      
      document.getElementById('project-explorer-btn').addEventListener('click', () => {
        windows.toggleVisibility('projectWindow');
        if (state.visibleWindows.projectWindow) {
          document.getElementById('project-explorer').style.zIndex = windows.getHighestZIndex() + 1;
        }
      });
      
      document.getElementById('properties-btn').addEventListener('click', () => {
        windows.toggleVisibility('propertyWindow');
        if (state.visibleWindows.propertyWindow) {
          document.getElementById('properties-window').style.zIndex = windows.getHighestZIndex() + 1;
        }
      });
      
      document.getElementById('form-view-btn').addEventListener('click', () => {
        if (state.visibleWindows.codeWindow) {
          windows.toggleVisibility('codeWindow');
        }
        windows.toggleVisibility('mainWindow');
        if (state.visibleWindows.mainWindow) {
          document.getElementById('form-designer').style.zIndex = windows.getHighestZIndex() + 1;
        }
      });
      
      document.getElementById('code-view-btn').addEventListener('click', () => {
        if (state.selectedControlId) {
          controlsManager.openCodeWindow(state.selectedControlId);
        } else {
          controlsManager.openFormCodeWindow();
        }
      });
    }
    
    // Initialize components
    function initAll() {
      windows.saveWindowSizes();
      menuSystem.init();
      controlsManager.init();
      propertiesWindow.init();
      projectExplorer.init();
      dialogManager.init();
      initWindowControls();
      initToolbarButtons();
      
      // Welcome toast
      setTimeout(() => {
        toast.show('Microsoft Visual Basic 6.0 IDE loaded');
      }, 500);
    }
    
    // Start the application
    document.addEventListener('DOMContentLoaded', initAll);
  </script>
</body>
</html>
